/*! gamee-js.2.0.0 18-04-2017 */

!function(a,b){function c(){function a(a){this[a]=b[a].bind(b)}var b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(a,this)}function d(a){return function(b){return b&&b.keyCode||(b||(b=window.event),b.which&&(b.keyCode=b.which)),a(b)}}function e(a,b){var c=this;l.call(this),this._pressed=!0,this.key=a,this.keyCode=b,this.on("keydown",function(){c._pressed=!0}),this.on("keyup",function(){c._pressed=!1})}function f(){var a=this;l.call(this),this.buttons={},this.buttonAlias={},this.on("$keydown",function(b){b.button&&a.buttonAlias[b.button]&&(b.button=a.buttonAlias[b.button]),a.trigger("keydown",b)}),this.on("$keyup",function(b){b.button&&a.buttonAlias[b.button]&&(b.button=a.buttonAlias[b.button]),a.trigger("keyup",b)}),this.on("keydown",function(b){b.button&&a.buttons[b.button]&&a.buttons[b.button].trigger("keydown")}),this.on("keyup",function(b){b.button&&a.buttons[b.button]&&a.buttons[b.button].trigger("keyup")})}function OneButtonController(){f.call(this),this.addButton(new e("button",32))}function TwoButtonController(){f.call(this),this.addButton(new e("left",37)),this.addButton(new e("right",39))}function TwoActionButtonsController(){f.call(this),this.addButton(new e("A",32)),this.addButton(new e("B",17))}function FourButtonController(){f.call(this),this.addButton(new e("up",38)),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("A",32))}function FiveButtonController(){f.call(this),this.addButton(new e("up",38)),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("down",40)),this.addButton(new e("A",32))}function SixButtonController(){f.call(this),this.addButton(new e("up",38)),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("down",40)),this.addButton(new e("A",32)),this.addButton(new e("B",17))}function TwoArrowsOneButtonController(){f.call(this),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("A",32))}function TwoArrowsTwoButtonsController(){f.call(this),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("A",32)),this.addButton(new e("B",17))}function FourArrowController(){f.call(this),this.addButton(new e("up",38)),this.addButton(new e("left",37)),this.addButton(new e("right",39)),this.addButton(new e("down",40))}function TouchController(){var a=this;f.call(this),this.on("$touchstart",function(b){a.trigger("touchstart",b)}),this.on("$touchend",function(b){a.trigger("touchend",b)}),this.on("$touchmove",function(b){a.trigger("touchmove",b)}),this.on("$touchleave",function(b){a.trigger("touchleave",b)}),this.on("$touchcancel",function(b){a.trigger("touchcancel",b)})}function JoystickController(){var a=this;f.call(this),this.x=0,this.y=0,this.on("$change",function(b){a.x=b.position.x,a.y=b.position.y,a.trigger("change",b)})}function JoystickButtonController(){JoystickController.call(this),this.addButton(new e("button",32))}function g(){this.requests={},this.platform="",this._init()}function h(a){this._gameeWin=a,g.call(this),this.platform="web"}function i(a){this.device=a,h.call(this),this.platform="mobile"}function j(){g.call(this),this.platform="fb"}function k(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=a,d.onreadystatechange=b,d.onload=b,c.appendChild(d)}!function(){var a=function(){var a=this,b={};a.on=function(a,c,d){if(!(arguments.length<2||"string"!=typeof a||"function"!=typeof c)){var e=c.toString();"undefined"!=typeof b[a]?"undefined"==typeof b[a].callbacks[e]?b[a].callbacks[e]={cb:c,once:!!d}:"boolean"==typeof d&&(b[a].callbacks[e].once=d):(b[a]={callbacks:{}},b[a].callbacks[e]={cb:c,once:!!d})}},a.once=function(b,c){a.on(b,c,!0)},a.off=function(a,c){if("string"==typeof a&&"undefined"!=typeof b[a])if("function"==typeof c){var d=c.toString(),e=b[a].callbacks[d];"undefined"!=typeof e&&delete b[a].callbacks[d]}else delete b[a]},a.trigger=function(c,d){if("string"==typeof c&&"undefined"!=typeof b[c])for(var e in b[c].callbacks){var f=b[c].callbacks[e];"function"==typeof f.cb&&f.cb(d),"boolean"==typeof f.once&&f.once===!0&&a.off(c,f.cb)}}};"undefined"!=typeof define&&define.amd?define(function(){"use strict";return new a}):"undefined"!=typeof module&&module.exports?module.exports=new a:window.Bullet=new a}(),function(){try{var a=new window.CustomEvent("test");if(a.preventDefault(),a.defaultPrevented!==!0)throw new Error("Could not prevent default")}catch(a){var b=function(a,b){var c,d;return b=b||{bubbles:!1,cancelable:!1,detail:void 0},c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),d=c.preventDefault,c.preventDefault=function(){d.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(a){this.defaultPrevented=!0}},c};b.prototype=window.Event.prototype,window.CustomEvent=b}}(),function(a,b){function c(a){var c=b[a];b[a]=function(a){return e(c(a))}}function d(b,c,d){return(d=this).attachEvent("on"+b,function(b){b=b||a.event,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},c.call(d,b)})}function e(a,b){if(b=a.length)for(;b--;)a[b].addEventListener=d;else a.addEventListener=d;return a}a.addEventListener||(e([b,a]),"Element"in a?a.Element.prototype.addEventListener=d:(b.attachEvent("onreadystatechange",function(){e(b.all)}),c("getElementsByTagName"),c("getElementById"),c("createElement"),e(b.all)))}(window,document);var l=Bullet.constructor;e.prototype=Object.create(l.constructor.prototype),e.constructor=e,e.prototype.isDown=function(){return this._pressed},f.prototype=Object.create(l.constructor.prototype),f.constructor=f,f.prototype.addButton=function(a){this.buttons[a.key]=a},f.prototype.enableKeyboard=function(a){var b,c,d={},e=this;for(b in this.buttons)c=this.buttons[b],c.keyCode&&(d[c.keyCode]=c);a._keydown(function(a){var b=d[a.keyCode];b&&(a.preventDefault(),e.trigger("keydown",{button:b.key}))}),a._keyup(function(a){var b=d[a.keyCode];b&&(a.preventDefault(),e.trigger("keyup",{button:b.key}))})},f.prototype.remapButton=function(a,b){if(b.name&&(b=b.name),!this.buttons[a])throw Error("Button "+a+" was not found in controller");this.buttonAlias[a]=b.name,this.buttons[b.name]=this.buttons[a],delete this.buttons[a]},OneButtonController.prototype=Object.create(f.prototype),OneButtonController.prototype.constructor=OneButtonController,TwoButtonController.prototype=Object.create(f.prototype),TwoButtonController.prototype.constructor=TwoButtonController,TwoActionButtonsController.prototype=Object.create(f.prototype),TwoActionButtonsController.prototype.constructor=TwoActionButtonsController,FourButtonController.prototype=Object.create(f.prototype),FourButtonController.prototype.constructor=FourButtonController,FiveButtonController.prototype=Object.create(f.prototype),FiveButtonController.prototype.constructor=FiveButtonController,SixButtonController.prototype=Object.create(f.prototype),SixButtonController.prototype.constructor=SixButtonController,TwoArrowsOneButtonController.prototype=Object.create(f.prototype),TwoArrowsOneButtonController.prototype.constructor=TwoArrowsOneButtonController,TwoArrowsTwoButtonsController.prototype=Object.create(f.prototype),TwoArrowsTwoButtonsController.prototype.constructor=TwoArrowsTwoButtonsController,FourArrowController.prototype=Object.create(f.prototype),FourArrowController.prototype.constructor=FourArrowController,TouchController.prototype=Object.create(TouchController.prototype),TouchController.prototype.constructor=TouchController,JoystickController.prototype=Object.create(f.prototype),JoystickController.prototype.constructor=JoystickController,JoystickButtonController.prototype=Object.create(JoystickController.prototype),JoystickButtonController.prototype.constructor=JoystickButtonController;var m=function(){function a(a,b){var c,d;if(!h[a])throw new Error("Unsupported controller type, "+a);if(b=b||{},d=new h[a],b.enableKeyboard&&d.enableKeyboard(g),b.buttons)for(c in b.buttons)d.remapButton(c,b.buttons[c]);return d}var c=function(){},e={},f={VERSION:"2.0",CAPABILITIES:["ghostMode","saveState","replay","socialData"],variant:0,soundUnlocked:!1,onReady:c,onGameStart:c},g={};g.gameeInit=function(a,b,c,d){var h=!0,i={};if(void 0!==c&&Array.isArray(c))for(var j=0;j<c.length;j++)"string"==typeof c[j]&&f.CAPABILITIES.indexOf(c[j])!==-1||(h=!1),i[c[j]]=!0;else h=!1;if(!h)throw"Capabilities array passed to gameeInit is void, malformed or unsupported capabilites requested.";this.native.createRequest("init",{version:f.VERSION,controller:a,capabilities:i},function(b){e.capabilities=i,"web"===this.native.platform||"fb"===this.native.platform?(b.controller=g.controller.requestController(a,{enableKeyboard:!0}),this._bindKeyboardTriggers(b.controller)):b.controller=g.controller.requestController(a,{}),d(b)}.bind(this))},g._bindKeyboardTriggers=function(a){b.addEventListener("message",function(b){switch(b.data[0]){case"button_button_down":a.trigger("keydown",{button:"button"});break;case"button_button_up":a.trigger("keyup",{button:"button"});break;case"button_left_up":a.trigger("keyup",{button:"left"});break;case"button_left_down":a.trigger("keydown",{button:"left"});break;case"button_right_down":a.trigger("keydown",{button:"right"});break;case"button_right_up":a.trigger("keyup",{button:"right"});break;case"button_up_down":a.trigger("keydown",{button:"up"});break;case"button_up_up":a.trigger("keyup",{button:"up"});break;case"button_down_down":a.trigger("keydown",{button:"down"});break;case"button_down_up":a.trigger("keyup",{button:"down"});break;case"button_a_down":a.trigger("keydown",{button:"A"});break;case"button_a_up":a.trigger("keyup",{button:"A"});break;case"button_b_down":a.trigger("keydown",{button:"B"});break;case"button_b_up":a.trigger("keyup",{button:"B"})}})},g.gameLoadingProgress=function(){var a=0;return function(b){if("number"!=typeof b||b<0||b>100)throw"Percentage passed to gameLoadingProgress out of bounds or not a number.";b>a&&(a=b,this.native.createRequest("gameLoadingProgress",{percentage:b}))}}(),g.gameReady=function(){this.native.createRequest("gameReady")},g.updateScore=function(a,b){if("number"!=typeof a)throw"Score passed to updateScore is not a number.";var c={score:parseInt(a,10)};b&&(c.ghostSign=!0),this.native.createRequest("updateScore",c)},g.gameOver=function(a){var b={};if(a){if(a.hasOwnProperty("variant")||(a.variant=""),!a.hasOwnProperty("data"))throw"Replay data must have `data` property";b.replayData=a}g.native.createRequest("gameOver",b)},g.gameSave=function(a,b){var c;if("object"!=typeof a)throw"data provided to gameSave function must be object";try{c=JSON.stringify(a)}catch(a){throw"data provided to gameSave function must be valid JSON: "+a}g.native.createRequest("saveState",{state:c,share:b})},g.requestSocial=function(a){this.native.createRequest("requestSocial",function(b){a(null,b)})},g.startSignal=function(a){var b;return a.replay&&!e.capabilities.replay&&(b="Game doesn't support replay. "),a.ghostMode&&!e.capabilities.ghostMode&&(b="Game doesn't support ghost Mode. "),b},g.controller={mainController:null,requestController:function(b,c){if("FullScreen"===b)return null;var d=a(b,c);return this.mainController=d,d},additionalController:function(b,c){var d=a(b,c);return gameeNative.additionalController(b),d},trigger:function(){if(!this.mainController)throw new Error("No controller present");this.mainController.trigger.apply(this.mainController,arguments)}},g._keydown=function(a){b.addEventListener("keydown",d(a))},g._keyup=function(a){b.addEventListener("keyup",d(a))};var h={OneButton:OneButtonController,TwoButtons:TwoButtonController,FourButtons:FourButtonController,FiveButtons:FiveButtonController,SixButtons:SixButtonController,FourArrows:FourArrowController,Touch:TouchController,Joystick:JoystickController,JoystickWithButton:JoystickButtonController,TwoArrowsTwoButtons:TwoArrowsTwoButtonsController,TwoArrowsOneButton:TwoArrowsOneButtonController,TwoActionButtons:TwoActionButtonsController};return g.registerPlatform=function(a){},g}(),n=function(){c.call(this)},Gamee=function(){this.emitter=new n};Gamee.prototype=function(){var a=function(a){if(a)throw"Error "+a.toString()};return{_controller:m.controller,gameInit:function(a,b,c,d){m.gameeInit(a,b,c,d)},gameLoadingProgress:function(b,c){c=c||a,m.gameLoadingProgress(b),c(null)},gameReady:function(b){b=b||a,m.gameReady(),b(null)},gameSave:function(b,c,d){var e,f=!1;"undefined"==typeof c?e=a:"function"==typeof c?e=c:"boolean"==typeof c&&(f=c,e=d||a),m.gameSave(b,f),e(null)},updateScore:function(b,c,d){"function"==typeof c&&(d=c,c=void 0),d=d||a,m.updateScore(b,c),d(null)},gameOver:function(b,c){"function"==typeof b&&(c=b,b=void 0),c=c||a,m.gameOver(b),c(null)},requestSocial:function(a){m.requestSocial(a)}}}();var o={emitter:null,pause:function(a){var b=new CustomEvent("pause",{detail:{callback:a}});this.emitter.dispatchEvent(b)},resume:function(a){var b=new CustomEvent("resume",{detail:{callback:a}});this.emitter.dispatchEvent(b)},ghostShow:function(a){var b=new CustomEvent("ghostShow",{detail:{callback:a}});this.emitter.dispatchEvent(b)},ghostHide:function(a){var b=new CustomEvent("ghostHide",{detail:{callback:a}});this.emitter.dispatchEvent(b)},mute:function(a){var b=new CustomEvent("mute",{detail:{callback:a}});this.emitter.dispatchEvent(b)},unmute:function(a){var b=new CustomEvent("unmute",{detail:{callback:a}});this.emitter.dispatchEvent(b)},start:function(a,b){var c=new CustomEvent("start",{detail:{callback:b}}),d=m.startSignal(a);return d?void b(d):(a.replay&&(c.detail.opt_replay=!0),a.ghostMode&&(c.detail.opt_ghostMode=!0),a.resetState&&(c.detail.opt_resetState=!0),void this.emitter.dispatchEvent(c))}};g.prototype={instCount:0,_init:function(){},createRequest:function(a,b,c){"function"==typeof b&&(c=b,b=void 0);var d=this.instCount++;"undefined"!=typeof c&&(this.requests[d]=c);var e={request:{method:a,messageId:d,data:null}};this.doCall(e,b)},doCall:function(a,b){throw"Not implemented"},_callback:function(a,b){var c=this.requests[a];delete this.requests[a],c&&c(b)},doResponse:function(a,b){throw"Not implemented"}},h.prototype=Object.create(g.prototype),h.prototype.constructor=h,h.prototype._init=function(){window.addEventListener("message",function(a){var b;if("object"==typeof a.detail&&null!==typeof a.detail)b=a.detail;else{if("object"!=typeof a.data)return;b=a.data}if(b.request&&b.request.method&&"undefined"!=typeof b.request.messageId)this._resolveAPICall(b.request.method,b.request.messageId,b.request.data);else if(b.response&&"undefined"!=typeof b.response.messageId){if(b.error)throw b.error;this._callback(b.response.messageId,b.response.data)}}.bind(this),!1)},h.prototype.doCall=function(a,b){"object"==typeof b&&(a.request.data=b||{}),this._gameeWin.postMessage(a,"*")},h.prototype.doResponse=function(a,b){var c={version:this.version,response:{messageId:a}};b&&(c.data=b),this._gameeWin.postMessage(c,"*")},h.prototype._resolveAPICall=function(a,b,c){var d=this.doResponse.bind(this,b);switch(a){case"pause":o.pause(d);break;case"resume":o.resume(d);break;case"mute":o.mute(d);break;case"unmute":o.unmute(d);break;case"ghostShow":o.ghostShow(d);break;case"ghostHide":o.ghostHide(d);break;case"start":if(!c)throw"Method _start missing params";o.start(c,d);break;default:console.error("Unknown method call")}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype._init=function(){if(h.prototype._init.call(this),"ios"===this.device)this._gameeWin=webkit.messageHandlers.callbackHandler;else{if("android"!==this.device)throw"Unknown device used in webkit bridge";this._gameeWin=_toDevice}window._triggerMessage=function(a){try{a=JSON.parse(a)}catch(b){throw"Couldn't parse message from native app: \n"+a+"\n"+b}this.dispatchEvent(new CustomEvent("message",{detail:a}))}},i.prototype.doCall=function(a,b){"object"==typeof b&&(a.request.data=b||{}),"android"===this.device&&(a=JSON.stringify(a)),this._gameeWin.postMessage(a,"*")},j.prototype=Object.create(g.prototype),j.prototype.constructor=j,j.prototype._init=function(){},j.prototype.createRequest=function(a,b,c){"function"==typeof b&&(c=b,b=void 0);try{this._methods[a](c,b)}catch(a){throw a}},j.prototype._methods={init:function(a,b){var c="https://connect.facebook.net/en_US/fbinstant.2.1.js";k(c,function(){FBInstant.initializeAsync().then(function(b){FBInstant.player.getDataAsync(["gamee"]).then(function(b){var c=b.gamee||null;a({saveState:c,replayData:null,sound:!0})})},function(a){throw a})})},gameLoadingProgress:function(a,b){FBInstant.setLoadingProgress(b.percentage)},gameReady:function(){FBInstant.setLoadingProgress(100),FBInstant.startGameAsync().then(function(){o.start({},function(){})})},updateScore:function(a,b){FBInstant.setScore(b.score)},gameOver:function(){FBInstant.endGameAsync().then(function(){o.start({},function(){})})},saveState:function(a,b){FBInstant.player.setDataAsync({gamee:b.state}).then(function(){console.log("FB: data is saved")})}},a=function(){var a=new Gamee,b=function(){var a,b="web";switch(userAgent=navigator.userAgent.toLowerCase(),window.parent!==window&&/facebook/.test(document.referrer)?b="fb":/iphone|ipod|ipad/.test(userAgent)?b=window.self!==window.top?"web":"ios":/gamee\/[0-9\.]+$/.test(userAgent)?b="android":window.parent?b="web":window.parent&&window.parent.gameeSimulator&&(b="web"),b){case"web":window.parent===window&&console.error("Gamee must run in iframe on web platform"),a=new h(window.parent);break;case"ios":a=new i("ios");break;case"android":a=new i("android");break;case"fb":a=new j("fb");break;default:throw"Can't identify the platform"}return a}();return m.PlatformAPI=o,m.native=b,o.emitter=a.emitter,a}(),b.gamee=a}({},function(){return this}());
//# sourceMappingURL=gamee-js.2.0.0.min.js.map